<div id="speech-line">
  The planets orbit the sun and stars fill the night sky
</div>

<style>
.word-block { display: inline-block; margin: 0 4px; padding: 4px 8px; border-radius: 6px; transition: color 0.5s, opacity 0.5s; color: gray; }
.current-word { animation: pulse 1s ease-in-out infinite; font-weight: 600; }
.past-word { opacity: 0.4; }
.word-yellow { border-bottom: 2px solid orange; font-weight: 600; }
.word-red { border-bottom: 2px solid red; font-weight: 600; }
@keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.2); } }
</style>

<script>
class WordFeedback {
  constructor(containerId) {
    this.container = document.getElementById(containerId);
    this.words = [];
    this.currentIndex = 0;
    this.initWords();
    this.startCurrentWord();
  }

  initWords() {
    const text = this.container.textContent.trim();
    const split = text.split(/\s+/);
    this.container.textContent = '';
    split.forEach((word, i) => {
      const span = document.createElement('span');
      span.textContent = word;
      span.classList.add('word-block');
      this.container.appendChild(span);
      this.words.push({ element: span, word: word });
      if (i < split.length - 1) this.container.appendChild(document.createTextNode(' '));
    });
  }

  startCurrentWord() {
    if (this.currentIndex >= this.words.length) return;
    const current = this.words[this.currentIndex];
    current.element.classList.add('current-word');

    // Delay for hesitation detection
    current.waitTimer = setTimeout(() => {
      current.element.classList.add('word-yellow'); // only add yellow if paused
    }, 2000);
  }

  userSaidWord(correct) {
    if (this.currentIndex >= this.words.length) return;
    const current = this.words[this.currentIndex];
    clearTimeout(current.waitTimer);
    current.element.classList.remove('current-word');

    // Fade correct words
    current.element.classList.add('past-word');

    // Only add red if really incorrect
    if (!correct) current.element.classList.add('word-red');

    this.currentIndex++;
    this.startCurrentWord();
  }
}

// Initialize
const tracker = new WordFeedback('speech-line');

// Example simulation
setTimeout(() => tracker.userSaidWord(true), 1500);
setTimeout(() => tracker.userSaidWord(true), 3000);
setTimeout(() => tracker.userSaidWord(false), 4500);
setTimeout(() => tracker.userSaidWord(true), 6000);
</script>